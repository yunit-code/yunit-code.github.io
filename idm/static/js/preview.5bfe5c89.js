(window["idmcore_webpackJsonp"]=window["idmcore_webpackJsonp"]||[]).push([["preview"],{"291b":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("8300");function n(e,t,a,n,o,i,r){try{var c=e[i](r),s=c.value}catch(l){return void a(l)}c.done?t(s):Promise.resolve(s).then(n,o)}function o(e){return function(){var t=this,a=arguments;return new Promise((function(o,i){var r=e.apply(t,a);function c(e){n(r,o,i,c,s,"next",e)}function s(e){n(r,o,i,c,s,"throw",e)}c(void 0)}))}}},"5b0b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"idm_render_engine_container"},[a("div",{attrs:{id:"idm_render_engine_page_container"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.dialogVisibleStatus,expression:"dialogVisibleStatus"}],staticClass:"idm_dialog_wrap_preview",attrs:{id:"idm_dialog_wrap",hideing:e.dialogIsHideing?"hideing":""}},e._l(e.dialogObjectList,(function(t,n){return a("div",{key:n,staticClass:"idm_dialog_shade_layer",class:"idm_dialog_shade_layer_"+t.packageid,attrs:{"dialog-id":t.packageid},on:{click:e.layerClickHandle}})})),0),a("div",{ref:"idm_page_root",staticClass:"idm_page_root",class:""+e.PageSettingData.id,attrs:{id:"PAGE_"+e.PageSettingData.id,"idm-com-anchor-id":e.PageSettingData.id}})]),a("a-drawer",{attrs:{title:e.pagePropData.drawerTitleShow?e.pagePropData.drawerTitle:"",placement:e.pagePropData.drawerPlacement||"right",closable:!1!==e.pagePropData.drawerClosable,destroyOnClose:e.pagePropData.drawerDestroyOnClose,maskClosable:!1!==e.pagePropData.drawerMaskClosable,mask:!1!==e.pagePropData.drawerMask,keyboard:!1!==e.pagePropData.drawerKeyboarde,maskStyle:e.commonCustomEventFunHandle(e.pagePropData,"drawerMaskStyleFunction")||{},wrapStyle:e.commonCustomEventFunHandle(e.pagePropData,"drawerWrapStyleFunction")||{},drawerStyle:e.commonCustomEventFunHandle(e.pagePropData,"drawerStyleFunction")||{},headerStyle:e.commonCustomEventFunHandle(e.pagePropData,"drawerHeaderStyleFunction")||{},bodyStyle:e.commonCustomEventFunHandle(e.pagePropData,"drawerBodyStyleFunction")||{},width:e.pagePropData.drawerWidth||256,height:e.pagePropData.drawerHeight||256,zIndex:e.pagePropData.drawerZIndex||1e3,wrapClassName:(e.pagePropData.drawerWrapClassName||"")+" idm_module_setting_drawer",visible:e.drawerVisible},on:{close:e.drawerOnClose,afterVisibleChange:e.drawerOnAfterVisibleChange}},[a("iframe",{staticClass:"idm_drawer_iframe_basestyle",attrs:{src:e.drawerIframeUrl,name:"idm_drawer_iframe"}})])],1)},o=[],i=a("291b"),r=a("b49e"),c=a("aa00"),s=a.n(c),l=(a("8300"),a("60fe"),a("c76c"),a("e157"),a("2ce8"),a("42ca"),a("7241"),a("792c"),a("77fa"),a("30f2"),a("8bbf")),d=a.n(l),u={fetchPageSettingDataForVersion:function(e){return e.savetype=IDM.setting.pageSchema.saveType,"disk"==IDM.setting.pageSchema.saveType&&e.version?IDM.http.get(IDM.setting.pageSchema.jsonDir.replace(/{projectNo}/g,e.projectNo||IDM.setting.webRoot.projectNo).replace(/{pageid}/g,e.pageid).replace(/{version}/g,e.version)):IDM.http.get(IDM.setting.api.pageSettingDataUrl||IDM.setting.mockurl.pageSettingDataUrl,e)},fetchApplicationInfo:function(e,t){return IDM.http.get(e,t)},fetchUserInfo:function(e,t){return IDM.http.get(e,t)},fetchUserCustomizationInfo:function(e,t){return IDM.http.get(e,t)},fetchThemeInfo:function(e,t){return IDM.http.get(e,t)},getPageInterfaceInfo:function(e,t){return IDM.http.get(e,t)},postPageInterfaceInfo:function(e,t,a){return IDM.http.post(e,t,a)}};d.a.prototype.$previewApi=u,d.a.prototype.$replace=function(e,t){return IDM.express.replace.call(this,e,t)},d.a.prototype.$eval=function(e,t){return IDM.express.eval.call(this,e,t)};var p={name:"Preview",components:{},data:function(){return{pageid:"",PageSettingData:{},dialogVisibleStatus:!1,dialogIsHideing:!1,dialogObjectList:[],drawerVisible:!1,drawerIframeUrl:"",drawerControlSetPanelOption:null,pagePropData:{}}},mounted:function(){this.windowResizeEvent((function(){IDM.broadcast.send({type:"pageResize",rangeModule:"",message:IDM.getClientWH()})}))},created:function(){var e=this;this.initCommonRequireJsCss(),this.pageid=this.$route.params.pageid,"devpreview"==this.pageid?(this.PageSettingData=JSON.parse(window.localStorage["devpreview"]),console.log("当前预览的缓存数据",this.PageSettingData),this.pageid=this.PageSettingData.id,this.loadPageElement()):this.$previewApi.fetchPageSettingDataForVersion({pageid:this.pageid,version:""}).then((function(t){e.PageSettingData=t.data.data,console.log("获取页面配置数据返回数据结果",e.PageSettingData),e.loadPageElement()})),this.injectInnerActionToWindow()},methods:{windowResizeEvent:function(e){window.onresize=function(){var t=this;t.resizeFlag&&clearTimeout(t.resizeFlag),t.resizeFlag=setTimeout((function(){e(),t.resizeFlag=null}),100)}},initLoadbarResource:function(){var e=this.PageSettingData.page.layout.props.compositeAttr;if(e.openPreviewLoadStyle){var t=e.previewLoadColor;t&&t.hex8&&document.documentElement.style.setProperty("--idmPreviewLoadColor",t.hex8),IDM.http.importFiles([IDM.url.getWebPath("~/lib/pace/pace.min.js"),IDM.url.getWebPath("~/lib/pace/minimal.css")]).then((function(){idmPace.stop(),Pace.start()})).catch((function(e){console.log("加载进度条文件出错")}))}else idmPace.stop()},drawerOnClose:function(){this.drawerVisible=!1,this.commonCustomEventFunHandle(null,"drawerCloseFunction")},drawerOnAfterVisibleChange:function(){this.commonCustomEventFunHandle(null,"drawerAfterVisibleChangeFunction")},beforeLoadingFunction:function(){var e=this.PageSettingData.page.layout.props.compositeAttr;e.beforeLoadingFunction&&e.beforeLoadingFunction.length>0&&this.commonCustomEventFunHandle(e,"beforeLoadingFunction")},afterLoadingFunction:function(){var e=this.PageSettingData.page.layout.props.compositeAttr;e.afterLoadingFunction&&e.afterLoadingFunction.length>0&&this.commonCustomEventFunHandle(e,"afterLoadingFunction")},layerClickHandle:function(e){var t=e.target.getAttribute("dialog-id");t&&this.IdmBuiltin_CloseDialog({targetModule:[{moduleId:t}]})},injectInnerActionToWindow:function(){window.IdmBuiltin_OpenControlSetPanel=this.IdmBuiltin_OpenControlSetPanel,window.IdmBuiltin_CloseControlSetPanel=this.IdmBuiltin_CloseControlSetPanel,window.IdmBuiltin_OpenUrl=this.IdmBuiltin_OpenUrl,window.IdmBuiltin_OpenDialog=this.IdmBuiltin_OpenDialog,window.IdmBuiltin_CloseDialog=this.IdmBuiltin_CloseDialog,window.IdmBuiltin_ShowModule=this.IdmBuiltin_ShowModule,window.IdmBuiltin_HideModule=this.IdmBuiltin_HideModule},IdmBuiltin_OpenControlSetPanel:function(e){var t=this.pagePropData.moduleControlCenterSettingUrl;if(t){if(t+=-1==t.indexOf("?")?"?":"&",e&&e.controlSetPanelOption){if(!(e.controlSetPanelOption.param&&e.controlSetPanelOption.param.marketModuleId&&e.controlSetPanelOption.param.pageId&&e.controlSetPanelOption.param.packageid))return;Object.keys(e.controlSetPanelOption.param).forEach((function(a,n){n>0&&(t+="&"),t=t+a+"="+e.controlSetPanelOption.param[a]}))}this.drawerIframeUrl=IDM.url.getWebPath(t),this.drawerControlSetPanelOption=e.controlSetPanelOption||null,this.drawerVisible=!0,this.drawerControlSetPanelOption&&this.drawerControlSetPanelOption.success&&this.drawerControlSetPanelOption.success(e.controlSetPanelOption.controlSetPanelId)}},IdmBuiltin_CloseControlSetPanel:function(e){if(e&&e.innerClose||e&&e.controlSetPanelOption&&e.controlSetPanelOption.controlSetPanelId&&this.drawerControlSetPanelOption&&e.controlSetPanelOption.controlSetPanelId==this.drawerControlSetPanelOption.controlSetPanelId)switch(this.drawerOnClose(),e.actionType){case"close":case"other":this.drawerControlSetPanelOption&&this.drawerControlSetPanelOption.other&&this.drawerControlSetPanelOption.other();break;case"commit":this.drawerControlSetPanelOption&&this.drawerControlSetPanelOption.yes&&this.drawerControlSetPanelOption.yes();break;case"reset":this.drawerControlSetPanelOption&&this.drawerControlSetPanelOption.reset&&this.drawerControlSetPanelOption.reset();break}},IdmBuiltin_OpenUrl:function(e){var t=e.customParam?e.customParam:e;window.open(IDM.url.getWebPath(t.openUrl),t.openName,t.openFeatures)},IdmBuiltin_OpenDialog:function(e){var t=this,a=e.customParam?e.customParam:e,n=[],o=0;if(a.targetModule.forEach((function(a){n.push(a.moduleId);var i=t.renderDialog(a.moduleId);!1!==i&&(i.dialogIsHideing=!1,e.layerOption&&(i.layerOption=e.layerOption),t.dialogObjectList.push(i),o++,$("#"+a.moduleId).css("display","flex"))})),0!=o){this.dialogVisibleStatus=!0,this.dialogIsHideing=!1;var i=this;this.$nextTick((function(){setTimeout((function(){i.sendBroadcastMessage({type:"linkageOpenDialog",message:e,rangeModule:n})}),5)})),e.callback&&e.callback()}},IdmBuiltin_CloseDialog:function(e){var t=this,a=e.customParam?e.customParam:e,n=[];a.targetModule.forEach((function(a){n.push(a.moduleId),t.dialogObjectList.forEach((function(t,n){t.packageid==a.moduleId&&(t.dialogIsHideing=!0,$(".idm_dialog_shade_layer_"+a.moduleId).attr("hideing","hideing"),t.layerOption&&t.layerOption.cancel&&t.layerOption.cancel(t),e.isOkEvent&&t.layerOption&&t.layerOption.yes&&t.layerOption.yes(t))}))})),this.dialogObjectList.length<=n.length&&(this.dialogIsHideing=!0);var o=this;o.sendBroadcastMessage({type:"linkageCloseDialog",message:e,rangeModule:n}),setTimeout((function(){a.targetModule.forEach((function(e){if($("#"+e.moduleId).css("display","none"),o.destroyDialog(e.moduleId),1!=o.dialogObjectList.length){var t=-1;o.dialogObjectList.forEach((function(a,n){a.packageid==e.moduleId&&(t=n,a.layerOption&&a.layerOption.end&&a.layerOption.end(a))})),t>-1&&o.dialogObjectList.splice(t,1)}else o.dialogObjectList=[]})),0==o.dialogObjectList.length&&(o.dialogVisibleStatus=!1,o.dialogIsHideing=!1)}),500),e.callback&&e.callback()},IdmBuiltin_ShowModule:function(e){var t=e.customParam?e.customParam:e,a=[];t.targetModule.forEach((function(e){a.push(e.moduleId),$("#"+e.moduleId).show()})),this.sendBroadcastMessage({type:"linkageShowModule",message:e,rangeModule:a}),e.callback&&e.callback()},IdmBuiltin_HideModule:function(e){var t=e.customParam?e.customParam:e,a=[];t.targetModule.forEach((function(e){a.push(e.moduleId),$("#"+e.moduleId).hide()})),this.sendBroadcastMessage({type:"linkageHideModule",message:e,rangeModule:a}),e.callback&&e.callback()},sendBroadcastMessage:function(e){window.IDM.broadcast&&window.IDM.broadcast.send(e)},weixinEventHandle:function(e){var t=this,a=this,n=e.compositeAttr;if(n.switchWeixinJSSDK){var o=IDM.setting.weixin.requireJsCss;if(o&&"string"==IDM.type(o)&&(o=[o]),o&&IDM.setting.weixin.signatureUrl){var i=[];o.forEach((function(e){return i.push(IDM.url.getWebPath(e))})),IDM.http.importFiles(i).then((function(){console.log("加载微信requireJsCss文件完成",i),IDM.http.post(IDM.setting.weixin.signatureUrl,Object(r["a"])({url:window.location.href.split("#")[0],pageid:a.pageid},a.commonParam())).then((function(e){var o=e.data;"200"==o.code&&o.data&&(o=o.data),wx.config({beta:!0,debug:!0===IDM.setting.weixin.debug,appId:o.appId,timestamp:o.timestamp,nonceStr:o.nonceStr,signature:o.signature,jsApiList:IDM.setting.weixin.jsApiList}),wx.ready((function(){var e=n.weixinReadyFunction;e&&e.forEach((function(e){try{window[e.name]&&window[e.name].call(t,Object(r["a"])(Object(r["a"])({},a.commonParam()),{},{customParam:e.param,_this:t}))}catch(n){}}))})),wx.error((function(e){var o=n.weixinErrorFunction;o&&o.forEach((function(n){try{window[n.name]&&window[n.name].call(t,Object(r["a"])(Object(r["a"])({},a.commonParam()),{},{customParam:n.param,_this:t,error:e}))}catch(o){}}))}))})).catch((function(e){}))})).catch((function(e){console.log("加载微信requireJsCss文件出错")}))}}},webSocketEventHandle:function(e){var t=this,a=e.compositeAttr;a.switchWebSocket&&(a.websocketInitName&&"function"==typeof window[a.websocketInitName]&&window[a.websocketInitName](),a.websocketOpenEvent&&(window[a.websocketOpenEvent]=function(){var e=this,n=a.websocketOpenFunction;n&&n.forEach((function(a){try{window[a.name]&&window[a.name].call(e,Object(r["a"])(Object(r["a"])({},t.commonParam()),{},{customParam:a.param,_this:e}))}catch(n){}}))}),a.websocketMessageEvent&&(window[a.websocketMessageEvent]=function(e){var n=this;IDM.broadcast.send({type:"websocket",rangeModule:"",globalSend:!0,message:e});var o=a.websocketMessageFunction;o&&o.forEach((function(a){try{window[a.name]&&window[a.name].call(n,Object(r["a"])(Object(r["a"])({},t.commonParam()),{},{customParam:a.param,msgData:e,_this:n}))}catch(o){}}))}))},initAppAndUserInfo:function(e){var t=this;return Object(i["a"])(s.a.mark((function a(){var n,o,i,c,l,d,u;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=t,o=e.compositeAttr,!o.openFetchApplicationInfo||!o.applicationInfoUrl){a.next=5;break}return a.next=5,t.$previewApi.fetchApplicationInfo(o.applicationInfoUrl,Object(r["a"])({pageid:t.pageid},t.commonParam())).then((function(e){var t=e.data;"200"==t.code&&t.data&&(t=t.data),IDM.app.setAppInfo(t)})).catch((function(e){}));case 5:if(!o.openFetchUserInfo||!o.userInfoUrl){a.next=8;break}return a.next=8,t.$previewApi.fetchUserInfo(o.userInfoUrl,Object(r["a"])({pageid:t.pageid},t.commonParam())).then((function(e){var t=e.data;"200"==t.code&&t.data&&(t=t.data),IDM.user.setCurrentUserInfo(t)})).catch((function(e){}));case 8:if(i="",o.switchUserInfo&&o.switchUserInfoFiledName?(c=o.switchUserInfoFiledName,l="userObject",d={IDM:window.IDM},d[l]=IDM.user.getCurrentUserInfo(),c&&(c=l+(c.startsWiths("[")?"":".")+c,i=window.IDM.express.replace.call(t,"@["+c+"]",d))):o.switchUserInfo&&(i=IDM.user.getCurrentUserInfo()&&IDM.user.getCurrentUserInfo().data?IDM.user.getCurrentUserInfo().data.userid:""),o.switchUserInfo&&!i&&(o.loginPageUrl?window.location.href=IDM.url.getWebPath(o.loginPageUrl):window.location.href=""),!(o.openFetchUserInfo&&o.userInfoUrl&&o.switchUserCustomization&&o.userCustomizationFetchUrl)){a.next=14;break}return a.next=14,t.$previewApi.fetchUserCustomizationInfo(o.userCustomizationFetchUrl,{pageid:t.pageid,version:t.PageSettingData.pageBaseInfo.version,urlData:JSON.stringify(t.commonParam())}).then((function(e){if(e&&e.data&&e.data.data&&e.data.data.customData){var t=e.data.data.customData instanceof Object?e.data.data.customData:JSON.parse(e.data.data.customData),a=t.children;if(!a||a&&0==a.length)return;var o=n.getModuleTree(n.PageSettingData.page.layout,t.packageid);if(o&&o.children){var i=[],r=[];a.forEach((function(e,t){r.push(e.packageid);for(var a=0;a<o.children.length;a++){var n=o.children[a];if(e.packageid==n.packageid&&!0!==e.hidden){i.push(n);break}}}));for(var c=0;c<o.children.length;c++){var s=o.children[c];-1==r.indexOf(s.packageid)&&i.push(s)}o.children=i}}})).catch((function(e){}));case 14:if(!o.openIdmTheme||"customInterface"!=o.themeFetchType||!o.themeInterfaceUrl){a.next=19;break}return a.next=17,t.$previewApi.fetchThemeInfo(o.themeInterfaceUrl,Object(r["a"])({pageid:t.pageid},t.commonParam())).then((function(e){n.themeInterfaceHandle(e.data,"resultData")})).catch((function(e){}));case 17:a.next=20;break;case 19:o.openIdmTheme&&"customFunction"==o.themeFetchType&&o.themeCustomFunction&&o.themeCustomFunction.length>0&&(u="",o.themeCustomFunction.forEach((function(e){try{u=window[e.name]&&window[e.name].call(t,Object(r["a"])(Object(r["a"])({},t.commonParam()),{},{customParam:e.param,_this:n}))}catch(a){}})),IDM.theme.setCurrentThemeInfo(u));case 20:case"end":return a.stop()}}),a)})))()},initCommonRequireJsCss:function(){if(IDM.setting.applications.commonRequireJsCss&&IDM.setting.applications.commonRequireJsCss instanceof Array){var e=[];IDM.setting.applications.commonRequireJsCss.forEach((function(t){return e.push(IDM.url.getWebPath(t))})),IDM.http.importFiles(e).then((function(){console.log("加载commonRequireJsCss文件完成",IDM.setting.applications.commonRequireJsCss)})).catch((function(e){console.log("加载commonRequireJsCss文件出错")}))}},initPulltorefreshPlugin:function(){var e=this,t=this.PageSettingData.page.layout.props.compositeAttr;t.openPulltorefresh&&IDM.http.importFiles([IDM.url.getWebPath("~/lib/pulltorefreshjs/index.umd.min.js")]).then((function(){console.log("加载pulltorefreshjs文件完成");PullToRefresh.init({mainElement:"body",instructionsPullToRefresh:"下拉刷新",instructionsReleaseToRefresh:"松手刷新",instructionsRefreshing:"刷新中",onRefresh:function(){e.initPulltorefreshHandle()}})})).catch((function(e){console.error("加载pulltorefreshjs文件出错")}))},initPulltorefreshHandle:function(){var e=this,t=this.PageSettingData.page.layout.props.compositeAttr;switch(t.pulltorefreshType){case"page":window.location.reload();break;case"data":IDM.broadcast.send({type:"linkageReload",rangeModule:"",message:(new Date).getTime()});break;case"custom":var a=t.pulltorefreshFunction;a&&a.forEach((function(t){window[t.name]&&window[t.name].call(e,{customParam:t.param})}));break}},themeInterfaceHandle:function(e,t){var a=this,n=this,o=this.PageSettingData.page.layout.props.compositeAttr,i=o.themeDataFiled,c=o.themeDataFunction,s=e;if(i){var l=i,d={IDM:window.IDM};d[t]=e,l&&(l=t+(l.startsWiths("[")?"":".")+l,s=window.IDM.express.replace.call(this,"@["+l+"]",d))}if(c&&c.length>0){var u=Object(r["a"])(Object(r["a"])({},n.commonParam()),{},{_this:n});u[t]=e,c.forEach((function(e){try{s=window[e.name]&&window[e.name].call(a,Object(r["a"])({customParam:e.param},u))}catch(t){}}))}IDM.theme.setCurrentThemeInfo(s)},loadPageElement:function(){var e=this;return Object(i["a"])(s.a.mark((function t(){var a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.initLoadbarResource(),e.PageSettingData.page.actions&&e.PageSettingData.page.actions.compiled&&(a=$('<script type="text/javascript" id="idm_page_script"/>'),$("body").append(a.html("var exports={};"+e.PageSettingData.page.actions.compiled))),e.PageSettingData.page.componentsMap.forEach((function(e){e.env="production"})),e.IDM.broadcast.registerModule(e.PageSettingData),document.title=e.PageSettingData.pageBaseInfo.title||"IDM预览",t.next=7,e.initAppAndUserInfo(e.PageSettingData.page.layout.props);case 7:e.webSocketEventHandle(e.PageSettingData.page.layout.props),e.weixinEventHandle(e.PageSettingData.page.layout.props),e.beforeLoadingFunction(),e.pageAttrPropHandle(e.PageSettingData.page.layout.props),e.$nextTick((function(){this.initModuleTreeToPage(null,!0,this.PageSettingData.page.layout)})),e.initPulltorefreshPlugin();case 13:case"end":return t.stop()}}),t)})))()},requestPageCommonInterfaceData:function(){if(this.IDM.broadcast.pageLoadCompleteAfter(),!this.isloadPageCommonInterface){this.isloadPageCommonInterface=!0,console.log("页面首屏组件已全部加载完毕！！！"),this.afterLoadingFunction();var e=(this.PageSettingData.page.layout.props.compositeAttr?this.PageSettingData.page.layout.props.compositeAttr.interfaceList:[])||[];if(0!=e.length){var t=this.pageid,a=[],n=[];this.PageSettingData.page.componentsMap.forEach((function(e){e.packageid!=t&&(a.push(e.packageid),n.push(e.comId))}));var o={idmPageId:t,moduleIds:a.join(","),componentIds:n.join(",")},i=IDM.url.queryObject();Object.keys(i).forEach((function(e){o[e]=i[e]})),this.orderlyRequestInterface(e,0,o)}}},orderlyRequestInterface:function(e,t,a){if(!(e.length<=t)){var n=e[t];t+=1;var o=this;if(n.preAllowFunction&&n.preAllowFunction.length>0)try{var i=Object(r["a"])(Object(r["a"])({},o.commonParam()),n.preAllowFunction[0].param),c=window[n.preAllowFunction[0].name]&&window[n.preAllowFunction[0].name].call(this,i);if(!1===c)return void o.orderlyRequestInterface(e,t,a)}catch(l){}if("post"==n.interfaceMode&&n.interfaceUrl){if(n.formDataFunction&&n.formDataFunction.length>0)try{i=Object(r["a"])(Object(r["a"])({},o.commonParam()),n.formDataFunction[0].param);var s=window[n.formDataFunction[0].name]&&window[n.formDataFunction[0].name].call(this,i);a=Object(r["a"])(Object(r["a"])({},a),s)}catch(l){}this.$previewApi.postPageInterfaceInfo(n.interfaceUrl,a,{headers:n.interfaceContentType?{"Content-Type":n.interfaceContentType||"application/json;charset=UTF-8"}:{}}).then((function(i){o.callbackModuleSetContext(n,i.data),o.orderlyRequestInterface(e,t,a)})).catch((function(n){o.orderlyRequestInterface(e,t,a)}))}else"get"==n.interfaceMode&&n.interfaceUrl?this.$previewApi.getPageInterfaceInfo(n.interfaceUrl,a).then((function(i){o.callbackModuleSetContext(n,i.data),o.orderlyRequestInterface(e,t,a)})).catch((function(n){o.orderlyRequestInterface(e,t,a)})):o.orderlyRequestInterface(e,t,a)}},callbackModuleSetContext:function(e,t){var a=this;if(this.PageSettingData.page.componentsMap.forEach((function(a){a.idmSetContextValue&&a.idmSetContextValue({type:"pageCommonInterface",key:e.resultDataName,data:t})})),e.interfaceRunLaterFunction&&e.interfaceRunLaterFunction.length>0){var n=e.interfaceRunLaterFunction;n.forEach((function(e){try{window[e.name]&&window[e.name].call(a,Object(r["a"])(Object(r["a"])({},a.commonParam()),{},{customParam:e.param,resultData:t,_this:a}))}catch(n){}}))}var o=this.PageSettingData.page.layout.props.compositeAttr||{};o.openIdmTheme&&"pageInterfaceResult"==o.themeFetchType&&o.themeDataName&&e.resultDataName==o.themeDataName&&this.themeInterfaceHandle(t,o.themeDataName)},pageAttrPropHandle:function(e){var t=e.compositeAttr;this.pagePropData=t;var a={};for(var n in t.bgSize&&"custom"==t.bgSize?a["background-size"]=(t.bgSizeWidth?t.bgSizeWidth.inputVal+t.bgSizeWidth.selectVal:"auto")+" "+(t.bgSizeHeight?t.bgSizeHeight.inputVal+t.bgSizeHeight.selectVal:"auto"):t.bgSize&&(a["background-size"]=t.bgSize),t.positionX&&t.positionX.inputVal&&(a["background-position-x"]=t.positionX.inputVal+t.positionX.selectVal),t.positionY&&t.positionY.inputVal&&(a["background-position-y"]=t.positionY.inputVal+t.positionY.selectVal),t)if(t.hasOwnProperty.call(t,n)){var o=t[n];if(!o&&!1!==o)continue;switch(n){case"defaultIdmTheme":IDM.theme.setCurrentThemeInfo(o);break;case"width":case"height":a[n]=o;break;case"bgColor":o.hex8&&(a["background-color"]=o.hex8);break;case"box":o.marginTopVal&&(a["margin-top"]="".concat(o.marginTopVal)),o.marginRightVal&&(a["margin-right"]="".concat(o.marginRightVal)),o.marginBottomVal&&(a["margin-bottom"]="".concat(o.marginBottomVal)),o.marginLeftVal&&(a["margin-left"]="".concat(o.marginLeftVal)),o.paddingTopVal&&(a["padding-top"]="".concat(o.paddingTopVal)),o.paddingRightVal&&(a["padding-right"]="".concat(o.paddingRightVal)),o.paddingBottomVal&&(a["padding-bottom"]="".concat(o.paddingBottomVal)),o.paddingLeftVal&&(a["padding-left"]="".concat(o.paddingLeftVal));break;case"bgImgUrl":a["background-image"]="url(".concat(IDM.url.getWebPath(o),")");break;case"icoImgUrl":var i=document.createElement("link");i.type="image/x-icon",i.rel="shortcut icon",i.href=IDM.url.getWebPath(o),document.getElementsByTagName("head")[0].appendChild(i);break;case"positionX":break;case"positionY":break;case"bgRepeat":a["background-repeat"]=o;break;case"bgAttachment":a["background-attachment"]=o;break;case"border":o.border.top.width>0&&(a["border-top-width"]=o.border.top.width+o.border.top.widthUnit,a["border-top-style"]=o.border.top.style,o.border.top.colors.hex8&&(a["border-top-color"]=o.border.top.colors.hex8)),o.border.right.width>0&&(a["border-right-width"]=o.border.right.width+o.border.right.widthUnit,a["border-right-style"]=o.border.right.style,o.border.right.colors.hex8&&(a["border-right-color"]=o.border.right.colors.hex8)),o.border.bottom.width>0&&(a["border-bottom-width"]=o.border.bottom.width+o.border.bottom.widthUnit,a["border-bottom-style"]=o.border.bottom.style,o.border.bottom.colors.hex8&&(a["border-bottom-color"]=o.border.bottom.colors.hex8)),o.border.left.width>0&&(a["border-left-width"]=o.border.left.width+o.border.left.widthUnit,a["border-left-style"]=o.border.left.style,o.border.left.colors.hex8&&(a["border-left-color"]=o.border.left.colors.hex8)),a["border-top-left-radius"]=o.radius.leftTop.radius+o.radius.leftTop.radiusUnit,a["border-top-right-radius"]=o.radius.rightTop.radius+o.radius.rightTop.radiusUnit,a["border-bottom-left-radius"]=o.radius.leftBottom.radius+o.radius.leftBottom.radiusUnit,a["border-bottom-right-radius"]=o.radius.rightBottom.radius+o.radius.rightBottom.radiusUnit;break;case"font":a["font-family"]=o.fontFamily,o.fontColors.hex8&&(a["color"]=o.fontColors.hex8),a["font-weight"]=o.fontWeight&&o.fontWeight.split(" ")[0],a["font-style"]=o.fontStyle,a["font-size"]=o.fontSize+o.fontSizeUnit,a["line-height"]=o.fontLineHeight+("-"==o.fontLineHeightUnit?"":o.fontLineHeightUnit),a["text-align"]=o.fontTextAlign,a["text-decoration"]=o.fontDecoration;break;case"layout":o.display&&"flex"==o.display?(a["display"]="flex",o.direction&&(a["flex-direction"]=o.direction),o.direction&&(a["align-items"]=o.align),o.direction&&(a["justify-content"]=o.justify)):o.display&&(a["display"]=o.display);break;case"pageMinWidth":o.inputVal&&o.selectVal&&(a["min-width"]=o.inputVal+o.selectVal);break}}this.$nextTick((function(e){if(t.watermarkType&&"none"!=t.watermarkType){var a=this.$replace(t.watermarkFont,{IDM:IDM}),n=this.$replace(t.watermarkFont1,{IDM:IDM});IDM.watermark.set(this.$refs.idm_page_root,t.watermarkZindex,"font"!=t.watermarkType?t.watermarkImg:a,"image"==t.watermarkType?"":n,{fontColor:t.watermarkColor&&t.watermarkColor.hex8,fontSize:"".concat(t.watermarkFontSize,"px"),width:t.watermarkSize,height:t.watermarkSize,rotate:t.watermarkRotate,imgSize:t.watermarkImgSize,imgLeftSize:t.watermarkImgLeftSize,fontLeftSize:t.watermarkFontLeftSize,opacity:t.watermarkOpacity/100,topSize:t.watermarkTopSize})}else IDM.watermark.close(this.$refs.idm_page_root)})),IDM.setStyleToPageHead("PAGE_"+this.PageSettingData.id,a),t.resourceList&&t.resourceList.length>0&&t.resourceList.forEach((function(e){"js"==e.resourceType?IDM.module.loadJs(IDM.url.getWebPath(e.resourceUrl),!0,(function(){}),{async:e.async,defer:e.defer}):IDM.module.loadCss(IDM.url.getWebPath(e.resourceUrl),!0,(function(){}))}))},renderDialog:function(e){var t=this.getModuleTree(this.PageSettingData.page.layout.children,e);if(!t)return!1;if("firstrender"==t.renderType||"activerender"==t.renderType){if(t.renderLicence=!0,"firstrender"==t.renderType&&t.loaded)return _.cloneDeep(t);this.IDM.broadcast.pageModuleLoadCompleteBefore(),this.resetLayoutInnerModuleLoadedStatus(t),this.initModuleTreeToPage(t)}return _.cloneDeep(t)},destroyDialog:function(e){var t=this.getModuleTree(this.PageSettingData.page.layout.children,e);t&&"activerender"==t.renderType&&$("#"+e).remove()},initModuleTreeToPage:function(e,t,a,n){var o,i=this;if(e=e||i.PageSettingData.page.layout.children,e instanceof Array||(e=[e]),e.forEach((function(e){if("dialog"==e.comType&&!0!==e.renderLicence){var t=e.props.compositeAttr.dialogRenderType;if(e.renderType=t,e.renderLicence=!("firstrender"==t||"activerender"==t),!e.renderLicence)return}e.loaded||o||(o=e,e.loaded=!0)})),o){var r=o;r.mountComplete=this.moduleMountComplete,r.moduleReload=this.moduleReload;var c=i.createModuleDom(r),s="";if("dialog"==r.comType)s=i.PageSettingData.id,$("#idm_dialog_wrap").append(c);else if(n)s=n,$("#"+s).after(c);else if(t&&a)if(s=a.packageid,s==i.PageSettingData.id)$("#PAGE_"+s).append(c);else{var l=$("#"+s);l.removeClass("drag_container_empty");var d=l.find(">*[idm-ctrl]");if(d.show(),r.containerIndex||"0"==r.containerIndex){var u=d.find(".drag_container[idm-ctrl-id='"+a.id+"'][idm-container-index="+r.containerIndex+"]");u&&u.append(c),u&&u.removeClass("drag_container_empty")}else d.append(c)}r.env="production",i.IDM.module.addModuleToQueue(r)}else e.forEach((function(e){("dialog"!=e.comType||e.renderLicence)&&e.children&&e.children.length>0&&i.initModuleTreeToPage(e.children,!0,e)}));return o},pageModuleDataIsLoaded:function(e,t){var a=this,n=this,o=!0;return e=e||n.PageSettingData.page.layout.children,e instanceof Array||(e=[e]),e.forEach((function(e){("dialog"!=e.comType||e.renderLicence)&&(e.loaded||(o=!1))})),o&&e.forEach((function(e){("dialog"!=e.comType||e.renderLicence)&&e.children&&e.children.length>0&&o&&(o=a.pageModuleDataIsLoaded(e.children,t))})),o},createModuleDom:function(e){e.packageid=e.packageid||"component_"+IDM.UUID(),e.id=e.id||e.packageid+"_inner";var t=$("<div />");return t.attr("id",e.packageid),t.attr("idm-com-anchor-id",e.packageid),t.attr("idm-com-id",e.comId),t.attr("idm-com-classid",e.classId),t.attr("idm-com-classname",e.className),t.addClass("idm_module"),t.addClass(e.packageid),t.append($("<div />").attr("id",e.id)),t},getModuleTree:function(e,t){var a,n=this;return e instanceof Array||(e=[e]),e.forEach((function(e){e.packageid==t?a=e:!a&&e.children&&(a=n.getModuleTree(e.children,t))})),a},moduleReload:function(e,t){var a,n=this.getModuleTree(this.PageSettingData.page.layout.children,e),o=[n];if(t||"0"==t)o=[],n&&n.children&&n.children.forEach((function(e){e.containerIndex==t&&o.push(e)})),a=n;else{var i=n.globalId.split("."),r=i.length<=2?i[0]:i[i.length-2];a=this.getModuleTree(this.PageSettingData.page.layout.children,r)}this.resetLayoutInnerModuleLoadedStatus(o),o&&o.forEach((function(e){$("#"+e.packageid).remove()})),this.initModuleTreeToPage(o,!0,a,!1)},moduleMountComplete:function(e){var t=this;this.PageSettingData.page.componentsMap.forEach((function(t){t.packageid==e.packageid&&(t.idmBroadcastMessage=e.idmBroadcastMessage,t.idmSetContextValue=e.idmSetContextValue,t.idmGetContextValue=e.idmGetContextValue)})),console.log("挂载完成，回调返回的数据",e);var a=this.getModuleTree(this.PageSettingData.page.layout.children,e.packageid);if(a.children&&a.children.length>0){var n=$("#"+e.packageid);if(0==n.find(":visible").length)var o=0,i=setInterval((function(){o++,0==$("#"+e.packageid).find(":visible").length&&o<=20||(clearInterval(i),t.moduleMountCompleteCommon(e))}),5);else setTimeout((function(){t.moduleMountCompleteCommon(e)}),3)}else setTimeout((function(){t.moduleMountCompleteCommon(e)}),3)},moduleMountCompleteCommon:function(e){var t=$("#"+e.packageid),a=t.find(">*[idm-ctrl]"),n=a.attr("idm-ctrl"),o=a.attr("idm-ctrl-id"),i=a.attr("id");switch(i||a.attr("id",o),n){case"drag_container":t.addClass("drag_container");break;case"drag_container_inlineblock":t.addClass("drag_container drag_container_inlineblock");break;case"idm_module":break}this.pageModuleDataIsLoaded(null,!0)?this.requestPageCommonInterfaceData():this.$nextTick((function(){this.initModuleTreeToPage(null,!0,this.PageSettingData.page.layout)}))},initModuleInnerEventHandle:function(e){var t=$("#"+e.packageid),a=t.find(".drag_container[idm-ctrl-id='"+e.id+"'][idm-ctrl-inner]");if(a.length>0){var n=this.getModuleTree(this.PageSettingData.page.layout.children,e.packageid);this.resetLayoutInnerModuleLoadedStatus(n.children),n.children&&n.children.length>0&&(n.children.forEach((function(e){$("#"+e.packageid).remove()})),this.initModuleTreeToPage(n.children,!0,n))}},resetLayoutInnerModuleLoadedStatus:function(e){var t=this;e instanceof Array||(e=[e]),e.forEach((function(e){delete e.loaded,e.children&&e.children.length>0&&t.resetLayoutInnerModuleLoadedStatus(e.children)}))},commonCustomEventFunHandle:function(e,t){var a=this,n=this;e=e||this.pagePropData;var o,i=e[t];return i&&i.forEach((function(e){o=window[e.name]&&window[e.name].call(a,Object(r["a"])(Object(r["a"])({},n.commonParam()),{},{customParam:e.param,_this:n}))})),o},commonParam:function(){var e=IDM.url.queryObject(),t={pageId:window.IDM.broadcast&&window.IDM.broadcast.pageModule?window.IDM.broadcast.pageModule.id:"",urlData:JSON.stringify(e)};return t}}},g=p,m=(a("a081"),a("cba8")),h=Object(m["a"])(g,n,o,!1,null,null,null);t["default"]=h.exports},a081:function(e,t,a){"use strict";a("fe54")},aa00:function(e,t,a){e.exports=a("e186")},fe54:function(e,t,a){}}]);
//# sourceMappingURL=preview.5bfe5c89.js.map